<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OIKOS · Dev Intelligence</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=Geist+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
/* ═══════════════════════════════════════════
   DESIGN SYSTEM
═══════════════════════════════════════════ */
:root {
  /* Core surfaces */
  --ink:    #020609;
  --dp1:    #050d18;
  --dp2:    #081422;
  --dp3:    #0b1a2e;
  --dp4:    #0f2240;
  --dp5:    #132952;

  /* Borders */
  --b0: #0d1e33;
  --b1: #132d4a;
  --b2: #1c3d62;
  --b3: #245078;

  /* Primary accent — Electric Indigo→Cyan gradient system */
  --p:   #4f8ef7;
  --pd:  #2563eb;
  --pl:  #7ab3ff;
  --pxl: #b3d1ff;
  --pbg: rgba(79,142,247,.1);
  --pbg2:rgba(79,142,247,.05);

  /* Semantic */
  --emerald: #00d68f;  --em-bg: rgba(0,214,143,.08);
  --sky:     #00c8f0;  --sk-bg: rgba(0,200,240,.08);
  --gold:    #ffc837;  --go-bg: rgba(255,200,55,.08);
  --coral:   #ff5c6a;  --co-bg: rgba(255,92,106,.08);
  --iris:    #8b72f8;  --ir-bg: rgba(139,114,248,.08);
  --mint:    #00e5c0;  --mn-bg: rgba(0,229,192,.08);

  /* Text hierarchy */
  --t0: #ffffff;
  --t1: #e8f0fe;
  --t2: #8aa4c8;
  --t3: #3d5a7a;
  --t4: #1a2e45;

  /* Fonts */
  --f-display: 'Syne', sans-serif;
  --f-mono:    'Geist Mono', monospace;

  /* Radii */
  --r1: 8px;
  --r2: 12px;
  --r3: 16px;
  --r4: 20px;
}

*, ::before, ::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body {
  font-family: var(--f-display);
  background: var(--ink);
  color: var(--t1);
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* ── Grid texture ── */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background-image: radial-gradient(circle, rgba(79,142,247,.04) 1px, transparent 1px);
  background-size: 32px 32px;
  opacity: .7;
}

/* ── Ambient blobs ── */
.blob {
  position: fixed; border-radius: 50%;
  filter: blur(130px); pointer-events: none; z-index: 0;
}
.blob-a { width: 900px; height: 900px; top: -450px; left: -200px; background: radial-gradient(circle, rgba(37,99,235,.14) 0%, transparent 70%); }
.blob-b { width: 700px; height: 700px; bottom: -350px; right: -200px; background: radial-gradient(circle, rgba(139,114,248,.09) 0%, transparent 70%); }
.blob-c { width: 400px; height: 400px; top: 40%; left: 55%; background: radial-gradient(circle, rgba(0,200,240,.05) 0%, transparent 70%); }

/* ═══════════════════════════════════════════
   LOADER
═══════════════════════════════════════════ */
#loader {
  position: fixed; inset: 0; z-index: 1000;
  background: var(--ink);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.ld-scene {
  display: flex; flex-direction: column; align-items: center; gap: 0;
  opacity: 0; animation: riseIn .7s .1s ease forwards;
}
.ld-orbit {
  position: relative; width: 120px; height: 120px;
  display: flex; align-items: center; justify-content: center;
  margin-bottom: 32px;
}
.ld-ring {
  position: absolute; inset: 0; border-radius: 50%;
  border: 1.5px solid transparent;
}
.ld-ring.r1 { border-top-color: var(--p);       animation: spin 1.6s linear infinite; }
.ld-ring.r2 { inset: 12px; border-top-color: var(--sky);    animation: spin 1.1s linear infinite reverse; }
.ld-ring.r3 { inset: 24px; border-top-color: var(--iris); animation: spin 2.4s linear infinite; opacity: .6; }
.ld-core {
  width: 64px; height: 64px; border-radius: 50%;
  background: linear-gradient(145deg, #141e2e, #1e2d42);
  border: 1px solid rgba(79,142,247,.25);
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 0 60px rgba(79,142,247,.3), inset 0 1px 0 rgba(255,255,255,.06);
}
.ld-core svg { width: 36px; height: 36px; fill: #cdd9f0; }
.ld-wordmark {
  font-size: 36px; font-weight: 800; letter-spacing: -1.5px; color: var(--t0);
  margin-bottom: 8px; line-height: 1;
}
.ld-wordmark em { font-style: normal; color: var(--pl); }
.ld-sub {
  font-family: var(--f-mono); font-size: 11px; color: var(--t3);
  letter-spacing: 2px; text-transform: uppercase; margin-bottom: 40px;
}
.ld-track {
  width: 280px; height: 1px; background: var(--b0);
  border-radius: 1px; overflow: hidden; margin-bottom: 14px;
}
.ld-prog { height: 100%; width: 0; background: linear-gradient(90deg, var(--pd), var(--p), var(--sky)); border-radius: 1px; transition: width .3s ease; }
.ld-status { font-family: var(--f-mono); font-size: 10px; color: var(--t3); letter-spacing: 1px; }

@keyframes riseIn { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
@keyframes spin    { to { transform: rotate(360deg) } }

/* ═══════════════════════════════════════════
   SIDEBAR
═══════════════════════════════════════════ */
#nav {
  position: fixed; left: 0; top: 0; bottom: 0; width: 58px;
  background: var(--dp1); border-right: 1px solid var(--b0);
  z-index: 100;
  display: flex; flex-direction: column; align-items: center; padding: 18px 0; gap: 2px;
}
.nav-logo {
  width: 34px; height: 34px; border-radius: 9px;
  background: linear-gradient(135deg, var(--pd), var(--p));
  display: flex; align-items: center; justify-content: center;
  font-family: var(--f-display); font-weight: 800; font-size: 10px; color: #fff;
  margin-bottom: 22px; box-shadow: 0 4px 20px rgba(79,142,247,.4);
  letter-spacing: .5px;
}
.nav-btn {
  width: 38px; height: 38px; border-radius: 9px; background: transparent; border: none;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
  color: var(--t3); transition: all .18s; position: relative;
}
.nav-btn svg { width: 16px; height: 16px; fill: none; stroke: currentColor; stroke-width: 1.7; stroke-linecap: round; stroke-linejoin: round; }
.nav-btn:hover { background: var(--pbg); color: var(--pl); }
.nav-btn.on    { background: var(--pbg); color: var(--pl); }
.nav-btn.on::before { content:''; position:absolute; left:0; top:28%; bottom:28%; width:2px; background:var(--pl); border-radius:0 2px 2px 0; }
.nav-sep { width: 26px; height: 1px; background: var(--b0); margin: 6px 0; }
.nav-foot { margin-top: auto; display: flex; flex-direction: column; align-items: center; gap: 2px; }

/* ═══════════════════════════════════════════
   APP SHELL
═══════════════════════════════════════════ */
#shell { margin-left: 58px; position: relative; z-index: 10; }

/* ═══════════════════════════════════════════
   TOPBAR
═══════════════════════════════════════════ */
#topbar {
  position: sticky; top: 0; z-index: 50;
  height: 54px; background: rgba(2,6,9,.92); backdrop-filter: blur(32px);
  border-bottom: 1px solid var(--b0);
  display: flex; align-items: center; padding: 0 28px; gap: 12px;
}
.top-title {
  font-size: 15px; font-weight: 700; letter-spacing: -.4px; color: var(--t1); flex: 1;
}
.top-title b { color: var(--pl); }

/* ── Filter tabs ── */
.filter-tabs {
  display: flex; gap: 2px; background: var(--dp2); border: 1px solid var(--b0);
  border-radius: var(--r2); padding: 3px;
}
.ftab {
  padding: 5px 13px; border-radius: 8px; font-family: var(--f-display);
  font-size: 11px; font-weight: 600; color: var(--t3);
  border: none; background: transparent; cursor: pointer; transition: all .18s;
  white-space: nowrap;
}
.ftab:hover { color: var(--t2); }
.ftab.on { background: var(--dp4); color: var(--pl); box-shadow: 0 1px 6px rgba(0,0,0,.4); }

/* ── Lang filter ── */
.lang-filter {
  display: flex; align-items: center; gap: 6px;
  background: var(--dp2); border: 1px solid var(--b0);
  border-radius: var(--r1); padding: 5px 10px; font-size: 11px; color: var(--t2); cursor: pointer;
  transition: border-color .18s;
}
.lang-filter:hover { border-color: var(--b1); }
.lang-filter select {
  background: transparent; border: none; color: var(--t2);
  font-family: var(--f-display); font-size: 11px; cursor: pointer; outline: none;
  padding-right: 4px;
}
.lang-filter select option { background: var(--dp3); color: var(--t1); }

.live-dot-wrap {
  display: flex; align-items: center; gap: 5px;
  background: var(--em-bg); border: 1px solid rgba(0,214,143,.2);
  padding: 4px 10px; border-radius: 20px; font-family: var(--f-mono);
  font-size: 9px; font-weight: 500; color: var(--emerald); letter-spacing: 1.5px;
}
.ldot { width: 5px; height: 5px; border-radius: 50%; background: var(--emerald); animation: blink 2s infinite; }
@keyframes blink { 0%,100%{box-shadow:0 0 0 0 rgba(0,214,143,.5)} 50%{box-shadow:0 0 0 5px transparent} }

.top-clock { font-family: var(--f-mono); font-size: 10px; color: var(--t3); min-width: 64px; }
.top-rate {
  font-family: var(--f-mono); font-size: 9px; color: var(--t3);
  background: var(--dp2); border: 1px solid var(--b0);
  padding: 4px 9px; border-radius: 6px; cursor: pointer; transition: border-color .18s;
}
.top-rate:hover { border-color: var(--b1); color: var(--t2); }
#btn-ref {
  display: flex; align-items: center; gap: 5px; padding: 6px 14px;
  border-radius: var(--r1); background: var(--pbg); border: 1px solid var(--b2);
  color: var(--pl); font-family: var(--f-display); font-size: 11px; font-weight: 600;
  cursor: pointer; transition: all .18s;
}
#btn-ref:hover { border-color: var(--p); background: rgba(79,142,247,.15); }
#btn-ref svg { width: 12px; height: 12px; fill:none; stroke:currentColor; stroke-width:2; stroke-linecap:round; stroke-linejoin:round; }
#btn-ref.sp svg { animation: spin .8s linear infinite; }

/* ═══════════════════════════════════════════
   MAIN LAYOUT — named grid areas
═══════════════════════════════════════════ */
#main {
  padding: 22px 28px 64px;
  display: grid;
  grid-template-columns: 1fr;
  gap: 22px;
}

/* ── Section label ── */
.sl {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 12px;
}
.sl-l {
  font-size: 9px; font-weight: 700; letter-spacing: 3px;
  text-transform: uppercase; color: var(--t3);
  display: flex; align-items: center; gap: 7px;
}
.sl-l::before { content:''; width:3px; height:13px; background: linear-gradient(180deg, var(--p), var(--sky)); border-radius: 2px; }
.sl-r {
  font-family: var(--f-mono); font-size: 9px; color: var(--pl);
  background: var(--pbg); border: 1px solid rgba(79,142,247,.18);
  padding: 2px 9px; border-radius: 20px;
}

/* ═══════════════════════════════════════════
   KPI STRIP
═══════════════════════════════════════════ */
.kpi-strip {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 10px;
}
.kpi {
  background: var(--dp2); border: 1px solid var(--b0); border-radius: var(--r2);
  padding: 15px 17px; position: relative; overflow: hidden;
  opacity: 0; animation: riseIn .5s forwards;
  transition: border-color .2s, transform .18s, box-shadow .18s;
  cursor: default;
}
.kpi:hover {
  border-color: var(--b2); transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0,0,0,.35);
}
.kpi-stripe { position: absolute; top: 0; left: 0; right: 0; height: 2px; border-radius: 2px 2px 0 0; }
.kpi-row { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 11px; }
.kpi-ico {
  width: 30px; height: 30px; border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
}
.kpi-ico svg { width: 14px; height: 14px; fill: none; stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; }
.kpi-tag {
  font-family: var(--f-mono); font-size: 8px; font-weight: 500;
  padding: 2px 5px; border-radius: 4px;
}
.kpi-tag.up { background: var(--em-bg); color: var(--emerald); }
.kpi-tag.dn { background: var(--co-bg); color: var(--coral); }
.kpi-tag.nt { background: var(--dp3); color: var(--t3); }
.kpi-num { font-size: 26px; font-weight: 800; color: var(--t0); line-height: 1; letter-spacing: -1.5px; margin-bottom: 4px; }
.kpi-lbl { font-size: 9px; text-transform: uppercase; letter-spacing: 2px; color: var(--t3); font-weight: 600; }

/* ═══════════════════════════════════════════
   CHART GRID — perfectly proportioned rows
═══════════════════════════════════════════ */

/* Row 1: commits (wide) | spotlight */
.row-a {
  display: grid;
  grid-template-columns: 62fr 38fr;
  gap: 14px;
  align-items: start;
}

/* Row 2: 3 equal charts */
.row-b {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 14px;
  align-items: start;
}

/* Row 3: 2 medium + 1 narrow (heatmap) */
.row-c {
  display: grid;
  grid-template-columns: 1fr 1fr 280px;
  gap: 14px;
  align-items: start;
}

/* Row 4: timeline (wide) | size chart */
.row-d {
  display: grid;
  grid-template-columns: 38fr 62fr;
  gap: 14px;
  align-items: start;
}

/* ── Panel card ── */
.card {
  background: var(--dp2); border: 1px solid var(--b0); border-radius: var(--r3);
  overflow: hidden;
  opacity: 0; animation: riseIn .5s forwards;
  transition: border-color .2s;
}
.card:hover { border-color: var(--b1); }
.card-inner { padding: 18px 20px; }
.card-hd { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
.card-title {
  font-size: 11px; font-weight: 600; color: var(--t2);
  display: flex; align-items: center; gap: 6px;
}
.card-title svg { width: 13px; height: 13px; fill: none; stroke: var(--p); stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; }
.card-meta { font-family: var(--f-mono); font-size: 9px; color: var(--t3); background: var(--dp3); border: 1px solid var(--b0); padding: 2px 7px; border-radius: 4px; }

/* Chart boxes — fixed heights, NO OVERLAP */
.ch { position: relative; width: 100%; }
.h160 { height: 160px; }
.h200 { height: 200px; }
.h220 { height: 220px; }
.h260 { height: 260px; }
.h300 { height: 300px; }

/* ═══════════════════════════════════════════
   SPOTLIGHT PANEL
═══════════════════════════════════════════ */
.spotlight {
  background: linear-gradient(160deg, var(--dp3) 0%, var(--dp2) 60%);
  border: 1px solid var(--b2); border-radius: var(--r3);
  padding: 20px; display: flex; flex-direction: column; gap: 14px;
  opacity: 0; animation: riseIn .5s .1s forwards;
}
.sp-eye {
  font-family: var(--f-mono); font-size: 8px; font-weight: 500;
  letter-spacing: 2.5px; text-transform: uppercase; color: var(--pl);
  display: flex; align-items: center; gap: 6px;
}
.sp-eye::before { content:''; width:6px; height:6px; border-radius:50%; background:var(--pl); box-shadow:0 0 8px var(--pl); }
.sp-name { font-size: 20px; font-weight: 800; color: var(--t0); letter-spacing: -.5px; line-height: 1.2; }
.sp-desc { font-size: 10px; color: var(--t3); line-height: 1.6; }
.sp-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
.sp-stat {
  background: var(--dp1); border: 1px solid var(--b1); border-radius: 9px;
  padding: 9px 10px; text-align: center;
}
.sp-val { font-size: 18px; font-weight: 800; color: var(--t0); letter-spacing: -.5px; }
.sp-lab { font-size: 8px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--t3); margin-top: 2px; }
.sp-bars { display: flex; flex-direction: column; gap: 9px; }
.sp-brow { display: flex; flex-direction: column; gap: 4px; }
.sp-blbl { display: flex; justify-content: space-between; font-size: 9px; color: var(--t3); font-family: var(--f-mono); }
.btrk { height: 4px; background: var(--b0); border-radius: 2px; overflow: hidden; }
.bfil { height: 100%; border-radius: 2px; transition: width 1.4s cubic-bezier(.16,1,.3,1); }
.lang-rows { display: flex; flex-direction: column; gap: 7px; }
.lr { display: flex; align-items: center; gap: 7px; }
.lr-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
.lr-nm { font-size: 10px; color: var(--t2); width: 82px; flex-shrink: 0; }
.lr-trk { flex: 1; height: 4px; background: var(--b0); border-radius: 2px; overflow: hidden; }
.lr-fil { height: 100%; border-radius: 2px; }
.lr-ct { font-family: var(--f-mono); font-size: 9px; color: var(--t3); width: 40px; text-align: right; }

/* ═══════════════════════════════════════════
   STORAGE
═══════════════════════════════════════════ */
.sg-wrap { display: flex; flex-direction: column; align-items: center; gap: 16px; padding: 4px 0; }
.sg-list { width: 100%; display: flex; flex-direction: column; gap: 9px; }
.sg-i { display: flex; align-items: center; gap: 7px; }
.sg-d { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
.sg-n { font-size: 10px; color: var(--t2); flex: 1; min-width: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.sg-t { flex: 2; height: 3px; background: var(--b0); border-radius: 2px; overflow: hidden; }
.sg-f { height: 100%; border-radius: 2px; }
.sg-v { font-family: var(--f-mono); font-size: 9px; color: var(--t2); font-weight: 500; flex-shrink: 0; width: 46px; text-align: right; }

/* ═══════════════════════════════════════════
   HEATMAP
═══════════════════════════════════════════ */
.hm-months { display: flex; gap: 3px; margin-bottom: 5px; overflow: hidden; }
.hm-month  { font-family: var(--f-mono); font-size: 7px; color: var(--t3); flex: 1; text-align: center; }
.hm-grid { display: flex; flex-direction: column; gap: 2px; }
.hm-row  { display: flex; gap: 2px; }
.hm-c {
  width: 11px; height: 11px; border-radius: 2px; flex-shrink: 0;
  transition: transform .12s, opacity .12s; cursor: default;
}
.hm-c:hover { transform: scale(1.6); z-index: 5; position: relative; }
.h0 { background: var(--b0); }
.h1 { background: rgba(79,142,247,.2); }
.h2 { background: rgba(79,142,247,.45); }
.h3 { background: rgba(79,142,247,.72); }
.h4 { background: var(--pl); box-shadow: 0 0 5px rgba(122,179,255,.5); }
.hm-leg { display: flex; align-items: center; gap: 3px; margin-top: 9px; font-family: var(--f-mono); font-size: 8px; color: var(--t3); }
.hm-leg .hm-c { width: 10px; height: 10px; }

/* ═══════════════════════════════════════════
   TIMELINE — vertical feed
═══════════════════════════════════════════ */
.tl-feed {
  max-height: 360px; overflow-y: auto; padding-right: 2px;
}
.tl-feed::-webkit-scrollbar { width: 3px; }
.tl-feed::-webkit-scrollbar-track { background: transparent; }
.tl-feed::-webkit-scrollbar-thumb { background: var(--b2); border-radius: 2px; }
.tl-ev {
  display: flex; gap: 10px; padding: 9px 0;
  border-bottom: 1px solid var(--b0); transition: background .14s;
}
.tl-ev:last-child { border-bottom: none; }
.tl-ev:hover { background: var(--pbg2); margin: 0 -20px; padding: 9px 20px; }
.tl-col { display: flex; flex-direction: column; align-items: center; width: 40px; flex-shrink: 0; }
.tl-ts  { font-family: var(--f-mono); font-size: 7px; color: var(--t3); text-align: center; white-space: nowrap; }
.tl-vl  { flex: 1; width: 1px; background: var(--b0); margin: 2px 0; min-height: 6px; }
.tl-dot { width: 7px; height: 7px; border-radius: 50%; border: 1.5px solid; flex-shrink: 0; }
.tl-dot.fr { background: var(--emerald); border-color: var(--emerald); box-shadow: 0 0 8px var(--emerald); }
.tl-dot.wm { background: var(--gold); border-color: var(--gold); }
.tl-dot.cl { background: var(--t4); border-color: var(--t4); }
.tl-body { flex: 1; min-width: 0; padding-left: 8px; }
.tl-repo { font-size: 11px; font-weight: 600; color: var(--t1); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 1px; }
.tl-msg  { font-family: var(--f-mono); font-size: 9px; color: var(--t3); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.tl-pills { display: flex; gap: 4px; margin-top: 3px; }
.tp { font-size: 7px; padding: 1px 5px; border-radius: 3px; font-weight: 600; border: 1px solid; letter-spacing: .5px; font-family: var(--f-mono); }
.tp.c { background: var(--pbg); color: var(--pl); border-color: rgba(79,142,247,.22); }
.tp.l { background: var(--dp3); color: var(--t3); border-color: var(--b0); }
.tl-sha { font-family: var(--f-mono); font-size: 8px; color: var(--t3); flex-shrink: 0; align-self: flex-start; padding-left: 6px; }

/* ═══════════════════════════════════════════
   TABLE
═══════════════════════════════════════════ */
.tbl-wrap { overflow-x: auto; }
.rtbl { width: 100%; border-collapse: collapse; }
.rtbl th {
  font-size: 8px; text-transform: uppercase; letter-spacing: 2px; color: var(--t3);
  padding: 0 12px 11px; text-align: left; border-bottom: 1px solid var(--b0);
  font-weight: 700; white-space: nowrap;
}
.rtbl td {
  padding: 9px 12px; font-size: 10px; color: var(--t2);
  border-bottom: 1px solid var(--b0); vertical-align: middle; white-space: nowrap;
}
.rtbl tr:last-child td { border-bottom: none; }
.rtbl tr:hover td { background: var(--pbg2); }
.rt-nm { font-size: 11px; font-weight: 600; color: var(--t1); max-width: 160px; overflow: hidden; text-overflow: ellipsis; display: block; }
.rt-lg { font-size: 8px; padding: 1px 6px; border-radius: 3px; font-weight: 600; border: 1px solid; font-family: var(--f-mono); }
.tc-b { color: var(--pl); font-weight: 600; font-family: var(--f-mono); }
.tc-g { color: var(--emerald); font-weight: 600; font-family: var(--f-mono); }
.tc-r { color: var(--coral); font-weight: 600; font-family: var(--f-mono); }
.rt-push { font-size: 8px; padding: 2px 6px; border-radius: 4px; font-family: var(--f-mono); display: inline-block; }
.rt-push.fr { background: var(--em-bg); color: var(--emerald); border: 1px solid rgba(0,214,143,.2); }
.rt-push.wm { background: var(--go-bg); color: var(--gold); border: 1px solid rgba(255,200,55,.2); }
.rt-push.cl { background: var(--dp3); color: var(--t3); border: 1px solid var(--b0); }
.rt-a { color: var(--pl); text-decoration: none; font-size: 12px; transition: color .15s; }
.rt-a:hover { color: var(--pxl); }

/* ═══════════════════════════════════════════
   REPO CARDS
═══════════════════════════════════════════ */
.cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(310px, 1fr)); gap: 10px; }
.rc {
  background: var(--dp2); border: 1px solid var(--b0); border-radius: var(--r3);
  overflow: hidden; opacity: 0; transform: translateY(8px);
  animation: riseIn .4s forwards;
  transition: border-color .2s, box-shadow .2s, transform .2s;
}
.rc:hover {
  border-color: var(--b2);
  box-shadow: 0 12px 40px rgba(0,0,0,.5), 0 0 0 1px var(--b1), inset 0 1px 0 rgba(79,142,247,.07);
  transform: translateY(-3px);
}
.rc-top { height: 2px; }
.rc-body { padding: 14px 16px; display: flex; flex-direction: column; gap: 12px; }
.rc-hd { display: flex; align-items: flex-start; gap: 10px; }
.rc-ico {
  width: 32px; height: 32px; border-radius: 8px; flex-shrink: 0;
  background: var(--pbg); border: 1px solid var(--b1);
  display: flex; align-items: center; justify-content: center;
}
.rc-ico svg { width: 16px; height: 16px; fill: none; stroke: var(--pl); stroke-width: 1.7; stroke-linecap: round; stroke-linejoin: round; }
.rc-nm { font-size: 12px; font-weight: 700; color: var(--t0); margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.rc-ds { font-size: 9px; color: var(--t3); line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.rc-chip { display: inline-flex; align-items: center; gap: 3px; padding: 1px 6px; border-radius: 4px; font-size: 8px; font-weight: 600; border: 1px solid; flex-shrink: 0; font-family: var(--f-mono); }
.rc-chip-d { width: 4px; height: 4px; border-radius: 50%; }
.rc-nums { display: grid; grid-template-columns: repeat(4,1fr); border: 1px solid var(--b0); border-radius: 9px; overflow: hidden; }
.rn { padding: 8px 4px; display: flex; flex-direction: column; align-items: center; gap: 2px; border-right: 1px solid var(--b0); }
.rn:last-child { border-right: none; }
.rn:hover { background: rgba(255,255,255,.02); }
.rn svg { width: 10px; height: 10px; fill: none; stroke: var(--t3); stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; }
.rn-v { font-size: 13px; font-weight: 800; color: var(--t0); letter-spacing: -.5px; }
.rn-l { font-size: 7px; color: var(--t3); letter-spacing: 1px; text-transform: uppercase; }
.rc-bars { display: flex; flex-direction: column; gap: 5px; }
.rcb { display: flex; align-items: center; gap: 6px; }
.rcb-l { font-size: 8px; color: var(--t3); width: 40px; flex-shrink: 0; }
.rcb-t { flex: 1; height: 3px; background: var(--b0); border-radius: 2px; overflow: hidden; }
.rcb-f { height: 100%; border-radius: 2px; transition: width 1.1s cubic-bezier(.16,1,.3,1); }
.rcb-v { font-family: var(--f-mono); font-size: 8px; color: var(--t2); width: 20px; text-align: right; }
.rc-cms { display: flex; flex-direction: column; gap: 3px; }
.rc-clbl { font-size: 7px; text-transform: uppercase; letter-spacing: 2.5px; color: var(--t3); margin-bottom: 2px; font-weight: 600; }
.cm { display: flex; align-items: center; gap: 6px; padding: 5px 8px; border-radius: 6px; background: var(--dp3); border: 1px solid var(--b0); }
.cm:hover { border-color: var(--b1); }
.cm-h { font-family: var(--f-mono); font-size: 8px; color: var(--pl); font-weight: 600; flex-shrink: 0; min-width: 42px; }
.cm-m { font-size: 9px; color: var(--t2); flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.cm-t { font-family: var(--f-mono); font-size: 7px; color: var(--t3); flex-shrink: 0; }
.rc-ft { display: flex; align-items: center; justify-content: space-between; padding-top: 9px; border-top: 1px solid var(--b0); }
.pi { display: flex; align-items: center; gap: 5px; font-size: 8px; color: var(--t3); font-family: var(--f-mono); }
.pd { width: 5px; height: 5px; border-radius: 50%; }
.pd.fr { background: var(--emerald); box-shadow: 0 0 6px var(--emerald); }
.pd.wm { background: var(--gold); }
.pd.cl { background: var(--t4); }
.gh-a { display: flex; align-items: center; gap: 3px; color: var(--pl); text-decoration: none; font-size: 9px; font-weight: 600; transition: color .15s; }
.gh-a:hover { color: var(--pxl); }
.gh-a svg { width: 8px; height: 8px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

/* ═══════════════════════════════════════════
   TOKEN MODAL
═══════════════════════════════════════════ */
#tmod { display:none; position:fixed; inset:0; z-index:500; background:rgba(0,0,0,.8); backdrop-filter:blur(14px); align-items:center; justify-content:center; }
#tmod.o { display:flex; }
.mbox { background:var(--dp2); border:1px solid var(--b2); border-radius:var(--r4); padding:28px; width:420px; max-width:90vw; }
.m-t { font-size:16px; font-weight:800; color:var(--t0); margin-bottom:5px; letter-spacing:-.3px; }
.m-s { font-size:10px; color:var(--t3); line-height:1.7; margin-bottom:16px; }
.m-i { width:100%; padding:9px 13px; background:var(--dp1); border:1px solid var(--b2); border-radius:9px; color:var(--t1); font-family:var(--f-mono); font-size:11px; outline:none; margin-bottom:10px; transition:border-color .2s; }
.m-i:focus { border-color:var(--p); }
.m-bs { display:flex; gap:8px; }
.m-b { flex:1; padding:9px; border-radius:9px; font-family:var(--f-display); font-size:11px; font-weight:700; cursor:pointer; border:none; transition:all .2s; }
.m-b.p { background:var(--pd); color:#fff; }
.m-b.p:hover { background:var(--p); }
.m-b.s { background:var(--b0); color:var(--t3); }
.m-b.s:hover { color:var(--t2); }

/* Toast */
#toast { display:none; position:fixed; bottom:22px; left:50%; transform:translateX(-50%); background:var(--co-bg); border:1px solid rgba(255,92,106,.3); color:var(--coral); padding:9px 20px; border-radius:10px; font-size:11px; z-index:600; max-width:520px; text-align:center; }

/* ── Responsive ── */
@media(max-width:1440px) { .kpi-strip{grid-template-columns:repeat(4,1fr)} }
@media(max-width:1200px) { .row-a,.row-d{grid-template-columns:1fr} .row-b,.row-c{grid-template-columns:1fr 1fr} }
@media(max-width:900px)  { .row-b,.row-c{grid-template-columns:1fr} .kpi-strip{grid-template-columns:repeat(2,1fr)} }
@media(max-width:600px)  { #nav{display:none} #shell{margin-left:0} #main{padding:14px} }
</style>
</head>
<body>

<div class="blob blob-a"></div>
<div class="blob blob-b"></div>
<div class="blob blob-c"></div>

<!-- ════ LOADER ════ -->
<div id="loader">
  <div class="ld-scene">
    <div class="ld-orbit">
      <div class="ld-ring r1"></div>
      <div class="ld-ring r2"></div>
      <div class="ld-ring r3"></div>
      <div class="ld-core">
        <svg viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"/>
        </svg>
      </div>
    </div>
    <div class="ld-wordmark">OIKOS <em>Dev</em></div>
    <div class="ld-sub">analistadatos-Oikos · intelligence</div>
    <div class="ld-track"><div class="ld-prog" id="prog"></div></div>
    <div class="ld-status" id="stat">Inicializando...</div>
  </div>
</div>

<div id="toast"></div>

<!-- ════ TOKEN MODAL ════ -->
<div id="tmod">
  <div class="mbox">
    <div class="m-t">GitHub Token</div>
    <div class="m-s">Personal Access Token para repos privados y 5 000 req/h. Solo se guarda en tu navegador.</div>
    <input class="m-i" type="password" id="tki" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
    <div class="m-bs">
      <button class="m-b p" onclick="applyTk()">Aplicar</button>
      <button class="m-b s" onclick="closeTk()">Cancelar</button>
    </div>
  </div>
</div>

<!-- ════ SIDEBAR ════ -->
<div id="nav">
  <div class="nav-logo">OK</div>
  <button class="nav-btn on" title="Dashboard">
    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></svg>
  </button>
  <div class="nav-sep"></div>
  <button class="nav-btn" title="Token" onclick="openTk()">
    <svg viewBox="0 0 24 24"><circle cx="8" cy="15" r="5"/><path d="M21 3l-9.4 9.4M15.5 4.5l3 3"/></svg>
  </button>
  <button class="nav-btn" title="Refrescar" onclick="go()">
    <svg viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
  </button>
  <div class="nav-sep"></div>
  <div class="nav-foot">
    <button class="nav-btn" title="GitHub" onclick="window.open('https://github.com/'+ORG,'_blank')">
      <svg viewBox="0 0 24 24"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/></svg>
    </button>
  </div>
</div>

<!-- ════ APP ════ -->
<div id="shell">

  <!-- TOPBAR -->
  <div id="topbar">
    <div class="top-title">OIKOS <b>Dev Intelligence</b></div>

    <!-- Sort/filter tabs -->
    <div class="filter-tabs">
      <button class="ftab on" onclick="applySort('push',this)">Recientes</button>
      <button class="ftab" onclick="applySort('stars',this)">Stars</button>
      <button class="ftab" onclick="applySort('forks',this)">Forks</button>
      <button class="ftab" onclick="applySort('size',this)">Tamaño</button>
      <button class="ftab" onclick="applySort('issues',this)">Issues</button>
    </div>

    <!-- Language filter -->
    <div class="lang-filter">
      <svg viewBox="0 0 24 24" style="width:11px;height:11px;fill:none;stroke:var(--t3);stroke-width:1.8;stroke-linecap:round;stroke-linejoin:round"><polyline points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>
      <select id="lang-sel" onchange="applyLang()">
        <option value="">Todos los lenguajes</option>
      </select>
    </div>

    <div class="live-dot-wrap"><div class="ldot"></div>LIVE</div>
    <div class="top-clock" id="clk">—</div>
    <button class="top-rate" id="rate-btn" onclick="openTk()">60/h</button>
    <button id="btn-ref" onclick="go()">
      <svg viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
      Sync
    </button>
  </div>

  <!-- MAIN CONTENT -->
  <div id="main" style="display:none">

    <!-- ─── KPIs ─── -->
    <div>
      <div class="sl">
        <div class="sl-l">Métricas</div>
        <div class="sl-r" id="kpi-ts">—</div>
      </div>
      <div class="kpi-strip" id="kpi-strip">
        <div class="kpi" style="animation-delay:.02s">
          <div class="kpi-stripe" style="background:linear-gradient(90deg,var(--p),var(--sky))"></div>
          <div class="kpi-row"><div class="kpi-ico" style="background:var(--pbg)"><svg viewBox="0 0 24 24" style="stroke:var(--pl)"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg></div><span class="kpi-tag nt" id="k1t">—</span></div>
          <div class="kpi-num" id="k-r">—</div><div class="kpi-lbl">Repositorios</div>
        </div>
        <div class="kpi" style="animation-delay:.05s">
          <div class="kpi-stripe" style="background:linear-gradient(90deg,var(--gold),#ffdd80)"></div>
          <div class="kpi-row"><div class="kpi-ico" style="background:var(--go-bg)"><svg viewBox="0 0 24 24" style="stroke:var(--gold)"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg></div><span class="kpi-tag nt">★</span></div>
          <div class="kpi-num" id="k-s">—</div><div class="kpi-lbl">Stars</div>
        </div>
        <div class="kpi" style="animation-delay:.08s">
          <div class="kpi-stripe" style="background:linear-gradient(90deg,var(--sky),#80e5f8)"></div>
          <div class="kpi-row"><div class="kpi-ico" style="background:var(--sk-bg)"><svg viewBox="0 0 24 24" style="stroke:var(--sky)"><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M13 6h3a2 2 0 0 1 2 2v7"/><path d="M6 9v12"/></svg></div><span class="kpi-tag nt">⑂</span></div>
          <div class="kpi-num" id="k-f">—</div><div class="kpi-lbl">Forks</div>
        </div>
        <div class="kpi" style="animation-delay:.11s">
          <div class="kpi-stripe" style="background:linear-gradient(90deg,var(--coral),#ff8892)"></div>
          <div class="kpi-row"><div class="kpi-ico" style="background:var(--co-bg)"><svg viewBox="0 0 24 24" style="stroke:var(--coral)"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg></div><span class="kpi-tag" id="k-it">—</span></div>
          <div class="kpi-num" id="k-i">—</div><div class="kpi-lbl">Issues</div>
        </div>
        <div class="kpi" style="animation-delay:.14s">
          <div class="kpi-stripe" style="background:linear-gradient(90deg,var(--iris),#b09cff)"></div>
          <div class="kpi-row"><div class="kpi-ico" style="background:var(--ir-bg)"><svg viewBox="0 0 24 24" style="stroke:var(--iris)"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg></div><span class="kpi-tag nt">lang</span></div>
          <div class="kpi-num" id="k-l">—</div><div class="kpi-lbl">Lenguajes</div>
        </div>
        <div class="kpi" style="animation-delay:.17s">
          <div class="kpi-stripe" style="background:linear-gradient(90deg,var(--emerald),#80f0c4)"></div>
          <div class="kpi-row"><div class="kpi-ico" style="background:var(--em-bg)"><svg viewBox="0 0 24 24" style="stroke:var(--emerald)"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg></div><span class="kpi-tag up" id="k-ct">live</span></div>
          <div class="kpi-num" id="k-c">—</div><div class="kpi-lbl">Commits</div>
        </div>
        <div class="kpi" style="animation-delay:.20s">
          <div class="kpi-stripe" style="background:linear-gradient(90deg,var(--mint),#80f8e8)"></div>
          <div class="kpi-row"><div class="kpi-ico" style="background:var(--mn-bg)"><svg viewBox="0 0 24 24" style="stroke:var(--mint)"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg></div><span class="kpi-tag nt">MB</span></div>
          <div class="kpi-num" id="k-z">—</div><div class="kpi-lbl">Storage</div>
        </div>
      </div>
    </div>

    <!-- ─── ROW A: Commits 62% | Spotlight 38% ─── -->
    <div>
      <div class="sl"><div class="sl-l">Actividad</div><div class="sl-r" id="act-meta">—</div></div>
      <div class="row-a">
        <div class="card" style="animation-delay:.24s">
          <div class="card-inner">
            <div class="card-hd">
              <div class="card-title"><svg viewBox="0 0 24 24"><rect x="18" y="3" width="4" height="18"/><rect x="10" y="8" width="4" height="13"/><rect x="2" y="13" width="4" height="8"/></svg>Commits por repositorio</div>
              <div class="card-meta">top 12 activos</div>
            </div>
            <div class="ch h260"><canvas id="ch-com"></canvas></div>
          </div>
        </div>
        <div class="spotlight" id="spotlight">
          <div class="sp-eye">Repo más activo</div>
          <div class="sp-name" id="sp-nm">—</div>
          <div class="sp-desc" id="sp-ds">—</div>
          <div class="sp-stats" id="sp-st"></div>
          <div class="sp-bars" id="sp-br"></div>
          <div style="font-size:8px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;color:var(--t3)">Stack</div>
          <div class="lang-rows" id="sp-lg"></div>
        </div>
      </div>
    </div>

    <!-- ─── ROW B: 3 iguales — Lenguajes | Stars | Forks ─── -->
    <div>
      <div class="sl"><div class="sl-l">Rankings</div></div>
      <div class="row-b">
        <div class="card" style="animation-delay:.28s">
          <div class="card-inner">
            <div class="card-hd">
              <div class="card-title"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>Lenguajes</div>
              <div class="card-meta" id="lm">—</div>
            </div>
            <div class="ch h200"><canvas id="ch-lg"></canvas></div>
          </div>
        </div>
        <div class="card" style="animation-delay:.31s">
          <div class="card-inner">
            <div class="card-hd">
              <div class="card-title"><svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>Stars</div>
            </div>
            <div class="ch h200"><canvas id="ch-st"></canvas></div>
          </div>
        </div>
        <div class="card" style="animation-delay:.34s">
          <div class="card-inner">
            <div class="card-hd">
              <div class="card-title"><svg viewBox="0 0 24 24"><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M13 6h3a2 2 0 0 1 2 2v7"/><path d="M6 9v12"/></svg>Forks</div>
            </div>
            <div class="ch h200"><canvas id="ch-fk"></canvas></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ─── ROW C: Issues | Storage | Heatmap ─── -->
    <div id="row-health">
      <div class="sl"><div class="sl-l">Salud</div></div>
      <div class="row-c">
        <div class="card" id="card-issues" style="animation-delay:.37s">
          <div class="card-inner">
            <div class="card-hd"><div class="card-title"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>Issues</div></div>
            <div class="ch h200"><canvas id="ch-is"></canvas></div>
          </div>
        </div>
        <div class="card" style="animation-delay:.40s">
          <div class="card-inner">
            <div class="card-hd"><div class="card-title"><svg viewBox="0 0 24 24"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>Almacenamiento</div></div>
            <div class="sg-wrap" id="sg-wrap"></div>
          </div>
        </div>
        <div class="card" id="card-hm" style="animation-delay:.43s">
          <div class="card-inner">
            <div class="card-hd"><div class="card-title"><svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="3" y1="10" x2="21" y2="10"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="16" y1="2" x2="16" y2="6"/></svg>Actividad 90d</div></div>
            <div class="hm-grid" id="hm-grid"></div>
            <div class="hm-leg">Menos<div class="hm-c h0"></div><div class="hm-c h1"></div><div class="hm-c h2"></div><div class="hm-c h3"></div><div class="hm-c h4"></div>Más</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ─── ROW D: Size 38% | Timeline 62% ─── -->
    <div id="row-d">
      <div class="sl"><div class="sl-l">Timeline & Tamaños</div><div class="sl-r" id="tl-cnt">0 eventos</div></div>
      <div class="row-d">
        <div class="card" style="animation-delay:.46s">
          <div class="card-inner">
            <div class="card-hd"><div class="card-title"><svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>Tamaño por repo (KB)</div></div>
            <div class="ch h220"><canvas id="ch-sz"></canvas></div>
          </div>
        </div>
        <div class="card" style="animation-delay:.49s">
          <div class="card-inner">
            <div class="card-hd"><div class="card-title"><svg viewBox="0 0 24 24"><line x1="12" y1="2" x2="12" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>Eventos recientes</div></div>
            <div class="tl-feed" id="tl-feed"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ─── Tabla ─── -->
    <div>
      <div class="sl"><div class="sl-l">Repositorios</div><div class="sl-r" id="tbl-c">—</div></div>
      <div class="card" style="animation-delay:.52s">
        <div class="card-inner" style="padding-bottom:4px">
          <div class="tbl-wrap">
            <table class="rtbl">
              <thead><tr><th>#</th><th>Repo</th><th>Lang</th><th>Stars</th><th>Forks</th><th>Issues</th><th>Tamaño</th><th>Rama</th><th>Push</th><th></th></tr></thead>
              <tbody id="tbl-b"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ─── Cards ─── -->
    <div>
      <div class="sl"><div class="sl-l">Cards</div><div class="sl-r" id="card-c">—</div></div>
      <div class="cards-grid" id="cards"></div>
    </div>

  </div><!-- /main -->
</div><!-- /shell -->

<script>
/* ════════════════════
   CONFIG
════════════════════ */
const ORG = 'analistadatos-Oikos';
let TK   = localStorage.getItem('gh_tk') || '';
let CHS  = {};
let ALL  = [];   // all repos
let CMTS = {};   // all commits
let SORT = 'push';
let LANG_F = '';

/* ════════════════════
   UTILS
════════════════════ */
const esc  = s => String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
const fkb  = k => k > 1024 ? (k/1024).toFixed(1)+'MB' : k+'KB';
const pcls = d => { const dy=d?(Date.now()-new Date(d))/864e5:999; return dy<7?'fr':dy<30?'wm':'cl'; };
function ago(d) {
  if(!d)return'—'; const s=(Date.now()-new Date(d))/1000;
  if(s<60)return'ahora'; if(s<3600)return~~(s/60)+'m';
  if(s<86400)return~~(s/3600)+'h'; if(s<604800)return~~(s/86400)+'d';
  if(s<2592000)return~~(s/604800)+'sem'; return~~(s/2592000)+'mes';
}
function pr(p){ document.getElementById('prog').style.width=p+'%'; }
function st(t){ document.getElementById('stat').textContent=t; }
function toast(m,d=8000){ const el=document.getElementById('toast'); el.textContent=m; el.style.display='block'; setTimeout(()=>el.style.display='none',d); }

/* ════════════════════
   TOKEN
════════════════════ */
function openTk()  { document.getElementById('tki').value=TK; document.getElementById('tmod').classList.add('o'); }
function closeTk() { document.getElementById('tmod').classList.remove('o'); }
function applyTk() {
  TK=document.getElementById('tki').value.trim();
  TK?localStorage.setItem('gh_tk',TK):localStorage.removeItem('gh_tk');
  document.getElementById('rate-btn').textContent=TK?'5000/h':'60/h';
  closeTk(); go();
}

/* ════════════════════
   API
════════════════════ */
function hd(){ const h={'Accept':'application/vnd.github+json'}; if(TK)h['Authorization']=`Bearer ${TK}`; return h; }
async function api(u){ const r=await fetch(u,{headers:hd()}); if(!r.ok)throw new Error(`HTTP ${r.status}`); return r.json(); }

/* ════════════════════
   LANG PALETTE
════════════════════ */
const LP = {
  JavaScript:{bg:'#1f1504',bd:'#ffc837',dot:'#ffc837',tx:'#ffd86b',ch:'rgba(255,200,55,.75)'},
  Python:    {bg:'#04101f',bd:'#4f8ef7',dot:'#4f8ef7',tx:'#7ab3ff',ch:'rgba(79,142,247,.75)'},
  HTML:      {bg:'#1a0600',bd:'#ff7043',dot:'#ff7043',tx:'#ff9070',ch:'rgba(255,112,67,.75)'},
  CSS:       {bg:'#080d26',bd:'#7c6ef5',dot:'#7c6ef5',tx:'#a697ff',ch:'rgba(124,110,245,.75)'},
  TypeScript:{bg:'#030e24',bd:'#2563eb',dot:'#2563eb',tx:'#7ab3ff',ch:'rgba(37,99,235,.75)'},
  Shell:     {bg:'#021510',bd:'#00d68f',dot:'#00d68f',tx:'#00f5a6',ch:'rgba(0,214,143,.75)'},
  Dockerfile:{bg:'#02131d',bd:'#00c8f0',dot:'#00c8f0',tx:'#40daf5',ch:'rgba(0,200,240,.75)'},
  Vue:       {bg:'#051a10',bd:'#42b883',dot:'#42b883',tx:'#72d4a3',ch:'rgba(66,184,131,.75)'},
  default:   {bg:'#0d1520',bd:'#3d5a7a',dot:'#8aa4c8',tx:'#8aa4c8',ch:'rgba(138,164,200,.75)'},
};
function lp(l){ return LP[l]||LP.default; }

/* ════════════════════
   CHART DEFAULTS
════════════════════ */
const TIP = { backgroundColor:'#0b1422', borderColor:'#1c3d62', borderWidth:1, titleColor:'#e8f0fe', bodyColor:'#8aa4c8', padding:10, cornerRadius:8 };
const CDF = {
  responsive:true, maintainAspectRatio:false,
  plugins:{ legend:{display:false}, tooltip:TIP },
  scales:{
    x:{ ticks:{color:'#3d5a7a',font:{family:'Geist Mono',size:8},maxRotation:38}, grid:{color:'#0d1e33'}, border:{color:'#0d1e33'} },
    y:{ ticks:{color:'#3d5a7a',font:{family:'Geist Mono',size:8}},               grid:{color:'#0d1e33'}, border:{color:'#0d1e33'} },
  },
};
function nukeChs(){ Object.values(CHS).forEach(c=>c.destroy()); CHS={}; }

/* ════════════════════
   FILTER CONTROLS
════════════════════ */
function applySort(s, el) {
  SORT = s;
  document.querySelectorAll('.ftab').forEach(b=>b.classList.remove('on'));
  el.classList.add('on');
  if(ALL.length) renderAll();
}
function applyLang() {
  LANG_F = document.getElementById('lang-sel').value;
  if(ALL.length) renderAll();
}
function filteredRepos() {
  let r = [...ALL];
  if(LANG_F) r = r.filter(x => x.language === LANG_F);
  const sortMap = {
    push:   (a,b) => new Date(b.pushed_at)-new Date(a.pushed_at),
    stars:  (a,b) => b.stargazers_count-a.stargazers_count,
    forks:  (a,b) => b.forks_count-a.forks_count,
    size:   (a,b) => b.size-a.size,
    issues: (a,b) => b.open_issues_count-a.open_issues_count,
  };
  return r.sort(sortMap[SORT]||sortMap.push);
}

/* ════════════════════
   BUILD CHARTS
════════════════════ */
function drawCharts(repos) {
  nukeChs();
  const top12 = [...repos].sort((a,b)=>new Date(b.pushed_at)-new Date(a.pushed_at)).slice(0,12);
  const sh = r => r.name.slice(0,14);

  /* Commits */
  CHS.com = new Chart(document.getElementById('ch-com'),{ type:'bar', data:{
    labels: top12.map(sh),
    datasets:[{ data:top12.map(r=>(CMTS[r.name]||[]).length),
      backgroundColor:top12.map(r=>lp(r.language).ch),
      borderColor:top12.map(r=>lp(r.language).bd),
      borderWidth:1, borderRadius:7, borderSkipped:false }]
  }, options:{...CDF} });

  /* Lang donut */
  const lc={}; repos.forEach(r=>{if(r.language)lc[r.language]=(lc[r.language]||0)+1;});
  const lk=Object.keys(lc).sort((a,b)=>lc[b]-lc[a]);
  document.getElementById('lm').textContent=lk.length+' techs';
  CHS.lg = new Chart(document.getElementById('ch-lg'),{ type:'doughnut', data:{
    labels:lk, datasets:[{ data:lk.map(l=>lc[l]), backgroundColor:lk.map(l=>lp(l).ch), borderColor:lk.map(l=>lp(l).bd), borderWidth:2, hoverOffset:7 }]
  }, options:{ responsive:true, maintainAspectRatio:false, cutout:'62%',
    plugins:{ legend:{ display:true, position:'right', labels:{ color:'#3d5a7a', font:{family:'Geist Mono',size:8}, boxWidth:7, padding:9, usePointStyle:true } }, tooltip:TIP } } });

  /* Stars */
  const byS=[...repos].sort((a,b)=>b.stargazers_count-a.stargazers_count).slice(0,10);
  CHS.st = new Chart(document.getElementById('ch-st'),{ type:'bar', data:{
    labels:byS.map(sh), datasets:[{ data:byS.map(r=>r.stargazers_count),
      backgroundColor:'rgba(255,200,55,.7)', borderColor:'#ffc837', borderWidth:1, borderRadius:5 }]
  }, options:{...CDF} });

  /* Forks horizontal */
  const byF=[...repos].sort((a,b)=>b.forks_count-a.forks_count).slice(0,10);
  CHS.fk = new Chart(document.getElementById('ch-fk'),{ type:'bar', data:{
    labels:byF.map(sh), datasets:[{ data:byF.map(r=>r.forks_count),
      backgroundColor:'rgba(0,200,240,.7)', borderColor:'#00c8f0', borderWidth:1, borderRadius:5 }]
  }, options:{...CDF, indexAxis:'y'} });

  /* Issues donut — only if data */
  const wI=[...repos].filter(r=>r.open_issues_count>0).sort((a,b)=>b.open_issues_count-a.open_issues_count).slice(0,10);
  const ciEl = document.getElementById('card-issues');
  if(wI.length) {
    ciEl.style.display='';
    CHS.is = new Chart(document.getElementById('ch-is'),{ type:'doughnut', data:{
      labels:wI.map(sh), datasets:[{ data:wI.map(r=>r.open_issues_count),
        backgroundColor:wI.map((_,i)=>`hsla(${210+i*28},72%,60%,.75)`), borderWidth:1, hoverOffset:6 }]
    }, options:{ responsive:true, maintainAspectRatio:false, cutout:'58%',
      plugins:{ legend:{ display:true, position:'right', labels:{ color:'#3d5a7a', font:{family:'Geist Mono',size:8}, boxWidth:7, padding:9, usePointStyle:true } }, tooltip:TIP } } });
  } else ciEl.style.display='none';

  /* Size line */
  const byZ=[...repos].sort((a,b)=>b.size-a.size).slice(0,12);
  CHS.sz = new Chart(document.getElementById('ch-sz'),{ type:'line', data:{
    labels:byZ.map(sh), datasets:[{ data:byZ.map(r=>r.size),
      borderColor:'#8b72f8', backgroundColor:'rgba(139,114,248,.07)',
      borderWidth:2, pointBackgroundColor:'#8b72f8', pointRadius:3, fill:true, tension:.4 }]
  }, options:{...CDF} });
}

/* ════════════════════
   STORAGE
════════════════════ */
function buildStorage(repos) {
  const tKB=repos.reduce((a,r)=>a+r.size,0);
  const tMB=(tKB/1024).toFixed(1);
  const pct=Math.min(~~((tKB/(1024*500))*100),100);
  const R=48,CX=68,CY=62,SW=9, circ=2*Math.PI*R, dash=circ*(pct/100);
  const top=[...repos].sort((a,b)=>b.size-a.size).slice(0,5);
  const mx=top[0]?.size||1;
  const gc=['#4f8ef7','#00c8f0','#00e5c0','#8b72f8','#ffc837'];
  document.getElementById('sg-wrap').innerHTML=`
    <svg width="136" height="96" viewBox="0 0 136 96" style="overflow:visible;flex-shrink:0">
      <defs><linearGradient id="sg" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="#2563eb"/><stop offset="100%" stop-color="#00c8f0"/>
      </linearGradient></defs>
      <circle cx="${CX}" cy="${CY}" r="${R}" fill="none" stroke="#0d1e33" stroke-width="${SW}"/>
      <circle cx="${CX}" cy="${CY}" r="${R}" fill="none" stroke="url(#sg)" stroke-width="${SW}"
        stroke-dasharray="${dash} ${circ}" stroke-linecap="round" transform="rotate(-90 ${CX} ${CY})"/>
      <text x="${CX}" y="${CY+5}" font-family="Syne" font-size="15" font-weight="800" fill="#e8f0fe" text-anchor="middle">${tMB}</text>
      <text x="${CX}" y="${CY+18}" font-family="Geist Mono" font-size="7" fill="#3d5a7a" text-anchor="middle" letter-spacing="1.5">MB TOTAL</text>
    </svg>
    <div class="sg-list">
      ${top.map((r,i)=>`<div class="sg-i">
        <div class="sg-d" style="background:${gc[i]}"></div>
        <div class="sg-n" title="${esc(r.name)}">${esc(r.name.slice(0,22))}</div>
        <div class="sg-t"><div class="sg-f" style="width:${~~((r.size/mx)*100)}%;background:${gc[i]}"></div></div>
        <div class="sg-v">${fkb(r.size)}</div>
      </div>`).join('')}
    </div>`;
}

/* ════════════════════
   HEATMAP
════════════════════ */
function buildHeatmap() {
  const counts={};
  Object.values(CMTS).flat().forEach(c=>{
    const d=new Date(c.date), k=`${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`;
    counts[k]=(counts[k]||0)+1;
  });
  const hasData=Object.keys(counts).length>0;
  document.getElementById('card-hm').style.display=hasData?'':'none';
  if(!hasData)return;
  const DAYS=91,now=Date.now(),cells=[];
  for(let i=DAYS-1;i>=0;i--){
    const d=new Date(now-i*864e5);
    cells.push(counts[`${d.getFullYear()}-${d.getMonth()}-${d.getDate()}`]||0);
  }
  const mx=Math.max(...cells,1),COLS=13;
  let h='';
  for(let r=0;r<Math.ceil(DAYS/COLS);r++){
    h+='<div class="hm-row">';
    for(let c=0;c<COLS;c++){
      const idx=r*COLS+c,v=idx<cells.length?cells[idx]:0;
      const lv=v===0?0:v<2?1:v<5?2:v<9?3:4;
      h+=`<div class="hm-c h${lv}" title="${v} commit${v!==1?'s':''} este día"></div>`;
    }
    h+='</div>';
  }
  document.getElementById('hm-grid').innerHTML=h;
}

/* ════════════════════
   TIMELINE
════════════════════ */
function buildTimeline(repos) {
  const evts=[];
  repos.forEach(r=>(CMTS[r.name]||[]).forEach(c=>evts.push({repo:r.name,...c})));
  evts.sort((a,b)=>new Date(b.date)-new Date(a.date));
  const top=evts.slice(0,30);
  document.getElementById('tl-cnt').textContent=`${top.length} eventos`;
  const feed=document.getElementById('tl-feed');
  if(!top.length){ document.getElementById('row-d').style.display='none'; return; }
  document.getElementById('row-d').style.display='';
  feed.innerHTML=top.map(e=>{
    const c=pcls(e.date),s=lp(e.lang);
    return`<div class="tl-ev">
      <div class="tl-col"><div class="tl-ts">${ago(e.date)}</div><div class="tl-vl"></div></div>
      <div style="padding-top:11px;flex-shrink:0"><div class="tl-dot ${c}"></div></div>
      <div class="tl-body">
        <div class="tl-repo">${esc(e.repo)}</div>
        <div class="tl-msg">${esc(e.message)}</div>
        <div class="tl-pills">
          <span class="tp c">commit</span>
          ${e.lang?`<span class="tp l" style="background:${s.bg};border-color:${s.bd};color:${s.tx}">${e.lang}</span>`:''}
        </div>
      </div>
      <div class="tl-sha">${e.sha}</div>
    </div>`;}).join('');
}

/* ════════════════════
   SPOTLIGHT
════════════════════ */
function buildSpotlight(repos) {
  const top=[...repos].sort((a,b)=>new Date(b.pushed_at)-new Date(a.pushed_at))[0];
  if(!top)return;
  document.getElementById('sp-nm').textContent=top.name;
  document.getElementById('sp-ds').textContent=top.description||'Sin descripción';
  const mxS=Math.max(...repos.map(r=>r.stargazers_count),1);
  const cLen=(CMTS[top.name]||[]).length;
  document.getElementById('sp-st').innerHTML=`
    <div class="sp-stat"><div class="sp-val">${top.stargazers_count}</div><div class="sp-lab">Stars</div></div>
    <div class="sp-stat"><div class="sp-val">${top.forks_count}</div><div class="sp-lab">Forks</div></div>
    <div class="sp-stat"><div class="sp-val">${top.open_issues_count}</div><div class="sp-lab">Issues</div></div>
    <div class="sp-stat"><div class="sp-val">${fkb(top.size)}</div><div class="sp-lab">Size</div></div>`;
  document.getElementById('sp-br').innerHTML=`
    <div class="sp-brow"><div class="sp-blbl"><span>Stars vs org max</span><span>${top.stargazers_count}/${mxS}</span></div>
      <div class="btrk"><div class="bfil" style="width:${~~((top.stargazers_count/mxS)*100)}%;background:linear-gradient(90deg,#ffc837,#ffe080)"></div></div></div>
    <div class="sp-brow"><div class="sp-blbl"><span>Commits recientes</span><span>${cLen}/5</span></div>
      <div class="btrk"><div class="bfil" style="width:${Math.min((cLen/5)*100,100)}%;background:linear-gradient(90deg,#4f8ef7,#00c8f0)"></div></div></div>`;
  const lc={}; repos.forEach(r=>{if(r.language)lc[r.language]=(lc[r.language]||0)+1;});
  const lk=Object.keys(lc).sort((a,b)=>lc[b]-lc[a]).slice(0,5);
  const mxL=lc[lk[0]]||1;
  const gc=['#4f8ef7','#00c8f0','#00e5c0','#8b72f8','#ffc837'];
  document.getElementById('sp-lg').innerHTML=lk.map((l,i)=>{const s=lp(l);return`
    <div class="lr"><div class="lr-dot" style="background:${s.dot}"></div>
      <div class="lr-nm">${l}</div>
      <div class="lr-trk"><div class="lr-fil" style="width:${~~((lc[l]/mxL)*100)}%;background:${gc[i]}"></div></div>
      <div class="lr-ct">${lc[l]} repos</div>
    </div>`;}).join('');
}

/* ════════════════════
   TABLE
════════════════════ */
function buildTable(repos) {
  document.getElementById('tbl-c').textContent=`${repos.length} repos`;
  document.getElementById('tbl-b').innerHTML=repos.map((r,i)=>{
    const s=lp(r.language),c=pcls(r.pushed_at);
    return`<tr>
      <td style="color:var(--t3);font-family:var(--f-mono);font-size:9px">${i+1}</td>
      <td><span class="rt-nm">${esc(r.name)}</span></td>
      <td>${r.language?`<span class="rt-lg" style="background:${s.bg};border-color:${s.bd};color:${s.tx}">${r.language}</span>`:'—'}</td>
      <td class="tc-b">${r.stargazers_count}</td><td class="tc-b">${r.forks_count}</td>
      <td class="${r.open_issues_count?'tc-r':'tc-g'}">${r.open_issues_count}</td>
      <td style="color:var(--t2)">${fkb(r.size)}</td>
      <td style="color:var(--t2)">${esc(r.default_branch)}</td>
      <td><span class="rt-push ${c}">${ago(r.pushed_at)}</span></td>
      <td><a href="${r.html_url}" target="_blank" class="rt-a">↗</a></td>
    </tr>`;}).join('');
}

/* ════════════════════
   CARDS
════════════════════ */
function buildCard(repo,idx) {
  const s=lp(repo.language),c=pcls(repo.pushed_at);
  const commits=CMTS[repo.name]||[];
  const mxS=Math.max(...ALL.map(r=>r.stargazers_count),1);
  const mxF=Math.max(...ALL.map(r=>r.forks_count),1);
  const ag=c==='fr'?'linear-gradient(90deg,var(--emerald),var(--sky),transparent)':
           c==='wm'?'linear-gradient(90deg,var(--gold),transparent)':'linear-gradient(90deg,var(--b1),transparent)';
  const chip=repo.language?`<span class="rc-chip" style="background:${s.bg};border-color:${s.bd};color:${s.tx}"><span class="rc-chip-d" style="background:${s.dot}"></span>${repo.language}</span>`:'';
  const crows=commits.slice(0,3).map(cm=>`<div class="cm"><span class="cm-h">${cm.sha}</span><span class="cm-m">${esc(cm.message)}</span><span class="cm-t">${ago(cm.date)}</span></div>`).join('')
    ||`<div class="cm"><span class="cm-m" style="color:var(--t3)">Sin commits</span></div>`;
  return`<div class="rc" style="animation-delay:${.022*idx}s">
    <div class="rc-top" style="background:${ag}"></div>
    <div class="rc-body">
      <div class="rc-hd">
        <div class="rc-ico"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div>
        <div style="flex:1;min-width:0">
          <div style="display:flex;align-items:center;gap:6px;margin-bottom:2px"><div class="rc-nm">${esc(repo.name)}</div>${chip}</div>
          <div class="rc-ds">${esc(repo.description||'Sin descripción')}</div>
        </div>
      </div>
      <div class="rc-nums">
        <div class="rn"><svg viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg><div class="rn-v">${repo.stargazers_count}</div><div class="rn-l">Stars</div></div>
        <div class="rn"><svg viewBox="0 0 24 24"><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M13 6h3a2 2 0 0 1 2 2v7"/><path d="M6 9v12"/></svg><div class="rn-v">${repo.forks_count}</div><div class="rn-l">Forks</div></div>
        <div class="rn"><svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg><div class="rn-v">${repo.watchers_count}</div><div class="rn-l">Watch</div></div>
        <div class="rn"><svg viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg><div class="rn-v">${fkb(repo.size)}</div><div class="rn-l">Size</div></div>
      </div>
      <div class="rc-bars">
        ${[['Stars',repo.stargazers_count,mxS,'#ffc837'],['Forks',repo.forks_count,mxF,'#00c8f0'],['Issues',repo.open_issues_count,Math.max(repo.open_issues_count,1),'#ff5c6a']].map(([l,v,m,col])=>
        `<div class="rcb"><div class="rcb-l">${l}</div><div class="rcb-t"><div class="rcb-f" style="width:${m?~~((v/m)*100):0}%;background:${col}"></div></div><div class="rcb-v">${v}</div></div>`).join('')}
      </div>
      <div class="rc-cms"><div class="rc-clbl">Commits recientes</div>${crows}</div>
      <div class="rc-ft">
        <div class="pi"><div class="pd ${c}"></div>Push ${ago(repo.pushed_at)}</div>
        <a class="gh-a" href="${repo.html_url}" target="_blank"><svg viewBox="0 0 24 24"><line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/></svg>GitHub</a>
      </div>
    </div>
  </div>`;
}

/* ════════════════════
   RENDER ALL (re-runs on filter change)
════════════════════ */
function renderAll() {
  const repos = filteredRepos();
  drawCharts(repos);
  buildStorage(repos);
  buildHeatmap();
  buildTimeline(repos);
  buildSpotlight(repos);
  buildTable(repos);

  document.getElementById('card-c').textContent=`${repos.length} repos`;
  const grid=document.getElementById('cards');
  grid.innerHTML='';
  repos.forEach((r,i)=>grid.insertAdjacentHTML('beforeend',buildCard(r,i)));
}

/* ════════════════════
   FETCH COMMITS
════════════════════ */
async function fetchC(name,lang){
  try{
    const d=await api(`https://api.github.com/repos/${ORG}/${name}/commits?per_page=5`);
    return d.map(c=>({sha:c.sha.slice(0,7),message:c.commit.message.split('\n')[0].slice(0,65),date:c.commit.author.date,lang}));
  }catch{return[];}
}

/* ════════════════════
   MAIN LOADER
════════════════════ */
async function go() {
  document.getElementById('main').style.display='none';
  document.getElementById('loader').style.display='flex';
  document.getElementById('btn-ref').classList.add('sp');
  document.getElementById('rate-btn').textContent=TK?'5000/h':'60/h';
  pr(5); st('Conectando con GitHub API...');

  try {
    pr(14); st('Cargando repositorios...');
    ALL=[];
    for(const base of [`https://api.github.com/orgs/${ORG}/repos`,`https://api.github.com/users/${ORG}/repos`]){
      try{
        let p=1;
        while(true){const b=await api(`${base}?type=public&per_page=100&page=${p}&sort=pushed`);ALL=ALL.concat(b);if(b.length<100)break;p++;}
        if(ALL.length)break;
      }catch{ALL=[];}
    }
    if(!ALL.length)throw new Error('No se encontraron repositorios públicos.');
    pr(32);

    /* KPIs */
    const tS=ALL.reduce((a,r)=>a+r.stargazers_count,0);
    const tF=ALL.reduce((a,r)=>a+r.forks_count,0);
    const tI=ALL.reduce((a,r)=>a+r.open_issues_count,0);
    const tZ=(ALL.reduce((a,r)=>a+r.size,0)/1024).toFixed(1);
    const lgs=[...new Set(ALL.map(r=>r.language).filter(Boolean))];
    const now=new Date();

    document.getElementById('k-r').textContent=ALL.length;
    document.getElementById('k1t').textContent=ALL.length+' repos';
    document.getElementById('k-s').textContent=tS;
    document.getElementById('k-f').textContent=tF;
    document.getElementById('k-i').textContent=tI;
    document.getElementById('k-it').className='kpi-tag '+(tI?'dn':'up');
    document.getElementById('k-it').textContent=tI?tI+' open':'✓ limpio';
    document.getElementById('k-l').textContent=lgs.length;
    document.getElementById('k-z').textContent=tZ;
    document.getElementById('kpi-ts').textContent=now.toLocaleTimeString('es-CO');
    document.getElementById('clk').textContent=now.toLocaleTimeString('es-CO');

    /* Populate lang filter */
    const sel=document.getElementById('lang-sel');
    sel.innerHTML='<option value="">Todos los lenguajes</option>';
    lgs.sort().forEach(l=>{ const o=document.createElement('option'); o.value=l; o.textContent=l; sel.appendChild(o); });

    /* Commits */
    pr(40); CMTS={};
    for(let i=0;i<ALL.length;i+=4){
      const chunk=ALL.slice(i,i+4);
      const res=await Promise.all(chunk.map(r=>fetchC(r.name,r.language)));
      chunk.forEach((r,j)=>CMTS[r.name]=res[j]);
      pr(40+~~((i/ALL.length)*38)); st(`Commits ${Math.min(i+4,ALL.length)}/${ALL.length}`);
    }
    const tC=Object.values(CMTS).reduce((a,c)=>a+c.length,0);
    document.getElementById('k-c').textContent=tC;
    document.getElementById('k-ct').textContent=tC+' total';
    document.getElementById('act-meta').textContent=`${ALL.length} repos · ${tC} commits`;

    pr(82); st('Renderizando...');
    renderAll();
    pr(100);
    setTimeout(()=>{ document.getElementById('loader').style.display='none'; document.getElementById('main').style.display='grid'; },350);

  }catch(err){
    document.getElementById('loader').style.display='none';
    document.getElementById('main').style.display='grid';
    toast(err.message.includes('403')
      ?'⚠ Rate limit (60/h sin token). Sidebar → 🔑 → agrega tu GitHub Token.'
      :`⚠ ${err.message}`);
  }
  document.getElementById('btn-ref').classList.remove('sp');
}

/* Clock tick */
setInterval(()=>{ document.getElementById('clk').textContent=new Date().toLocaleTimeString('es-CO'); },1000);
go();
</script>
</body>
</html>
